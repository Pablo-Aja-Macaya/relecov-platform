{% extends "relecov_core/base.html" %}
{% load static %}
<!--{% include "relecov_core/JExcelFunctionality.html" %}-->
<!--{%load plotly_dash%}-->


{% block content %}

<script src="https://bossanova.uk/jspreadsheet/v4/jexcel.js"></script>
<link rel="stylesheet" href="https://bossanova.uk/jspreadsheet/v4/jexcel.css" type="text/css" />
<script src="https://jsuites.net/v4/jsuites.js"></script>
<link rel="stylesheet" href="https://jsuites.net/v4/jsuites.css" type="text/css" />
<<<<<<< HEAD
<!---->
<!--ISkyLims-->
<script src="{% static 'forms/js/relecov_forms.js' %}" crossorigin="anonymous"></script>
<!--End ISkyLims-->

<!--JExcel Luis-->
<div class="row row-space-4 margin-b-4  card bg-light">
    <div class="col-sm-12">
        <div class="tab">
            <button class="tablinks" onclick="summaryBin(event, 'newSamples')" id="defaultOpen">Record new Samples</button>
            <button class="tablinks" onclick="summaryBin(event, 'batchSamples')">Load batch new Samples</button>

<<<<<<< HEAD
            <div id="newSamples" class="tabcontent card-body">
                <div class="row row-space-4 margin-b-4">
                    <div class="col-sm-12" >
                        <div class="panel panel-default" >
                            <div class="panel-heading card-title"><h3>Record new Samples</h3></div>
                            <div class="panel-body" >
                                <br><br><br>
                                <form method="post" enctype="multipart/form-data" name="sampledefinition"  id="sampledefinition" class="form-horizontal well" style="min-height: 500px;">
                                    {% csrf_token %}
                                    <div class="scrolling-wrapper">
                                        <input type="hidden" name="action" value="recordsample"/>
                                        <div id="spreadsheet" class="overflow-scroll card-body" style="width: 100%;"></div>
                                        <br>
                                    </div> <!--  end of scrolling  -->
                                        <script>
                                            var data = [[],[],[],[],[],[]];//initialized with 6 empty rows
                                            var mySpreadsheet = jspreadsheet(document.getElementById('spreadsheet'), {
                                            data:data,
                                            csvHeaders:true,
                                            tableOverflow:true,
                                            columns: [
                                                { type: 'text', title:'Public Health sample id (SIVIES)', width:230 },
                                                { type: 'text', title:'Sample ID given by originating laboratory', width:280 },
                                                { type: 'text', title:'Sample ID given by the submitting laboratory', width:300 },
                                                { type: 'text', title:'Sample ID given in the microbiology lab', width:280 },
                                                { type: 'text', title:'Sample ID given if multiple rna-extraction or passages', width:280 },
                                                { type: 'text', title:'Sample ID given for sequencing', width:280 },
                                                { type: 'text', title:'Sample ID given by originating laboratory', width:280 },
                                                { type: 'text', title:'Sample ID given by the submitting laboratory', width:280 },
                                                { type: 'text', title:'Sample ID given in the microbiology lab', width:280 },
                                                { type: 'text', title:'Sample ID given if multiple rna-extraction or passages', width:280 },
                                                { type: 'dropdown', title:'Originating Laboratory', width:280, source:[ 
                                                "Hospital Clínic de Barcelona (HCB)", "Instituto de Salud Carlos III ", "Microbiología HUC San Cecilio, Granada ",
                                                "Microbiología. Hospital Universitario Virgen del Rocio. Sevillia", "Hospital Clínico Universitario Lozano Blesa", "Hospital Universitario Miguel Servet",
                                                "Centro de Investigación Biomédica de Aragón", "Hospital Universitario Central de Asturias", "Servicio de Microbiologia HU Son Espases", 
                                                "Hospital Universitario Ntra. Sra de Candelaria (HUNSC)", "Instituto Tecnológico y de Energías Renovables, S.A. (ITER) - centro de referencia",
                                                ] },
                                                { type: 'text', title:'Sample Collection Date', width:280 },
                                                { type: 'text', title:'Sample Received Date', width:280 },
                                                { type: 'dropdown', title:'Specimen source', width:280, source:[ 
                                                "Nasopharynx aspirate", "Oral epithelium from ectoderm biopsy", "Skin epidermis biopsy",
                                                "Epithelium biopsy", "Bronchial lymph node biopsy", "Hepatic diverticulum biopsy",
                                                "Liver bud biopsy", "Biliary bud biopsy", "Gall bladder biopsy", 
                                                "Liver biopsy", "Lung biopsy","Oropharynx biopsy","Nasopharynx biopsy","Respiratory tract biopsy",
                                                ] },
                                                { type: 'dropdown', title:'Environmental Material', width:280, source:[ 
                                                "Animal litter", "Animal manure", "Farmyard manure",
                                                "Fresh animal manure", "Horse manure", "Pig manure",
                                                "Stable manure", "Anthropogenic environmental material", "Agricultural environmental material", 
                                                "Food material", "Food isolate","Food source","Algae","Animal",
                                                ] },
                                                { type: 'text', title:'Host Age', width:280 },
                                                { type: 'text', title:'Host Gender', width:280 },
                                                { type: 'text', title:'Sequence file R1 fastq', width:280 },
                                                { type: 'text', title:'Sequence file R2 fastq', width:280 },
                                            ],

                                            allowInsertColumn:false,
                                            allowDeleteColumn:false,
                                            allowRenameColumn:false,
                                            csvFileName:'samples',
                                            //minDimensions:[{{sample_information.table_size}},3],
                                            });

                                            document.getElementById('download').onclick = function () {
                                                mySpreadsheet.download();
                                            }
                                        </script>
                                    <br><br>
                                    <br>
                                    <!--<input type="button" value="Download Spreadsheet" id="download"/>-->
                                    <button id="download" onclick="mySpreadsheet.download()">Download Spreadsheet</button>                                   }">Download Spreadsheet</button>
                                    <input class="btn pull-right btn-primary" type="submit" value="Submit">
                                </form>
                            </div>  <!--  end of panel body  -->
                        </div> <!--// end panel -->
                    </div> <!--// end col-sm-12  -->
                </div> <!--  end of row -->
            </div><!-- // end of tab newSample -->

                <div class="row row-space-4 margin-b-4 card-body">
                    <div class="col-sm-10 col-sm-offset-1 card" >
                        <div class="panel panel-default card-body">
                            <div class="panel-heading card-title mb-5"><h3 style="text-align:center">Load New Samples in batch</h3></div>
                            <div class="panel-body">
                                <form method="post" enctype="multipart/form-data" name="defineBatchSamples"  id="defineBatchSamples" class="form-horizontal well" style="min-height: 700px;">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="defineBatchSamples"/>
                                    <div  class="col-sm-12 card-body" >
                                        <div class="panel panel-default card">
                                            <div class="panel-heading card-title"><h3  style="text-align:center">Upload the excel file to define a batch of samples. </h3></div>
                                            <div class="panel-body">
                                                <div class="form-group required" style="margin-left:40%;">
                                                    <label class="col-sm-5  control-label" for="samplesExcel" ><td> Upload Samples file</td> </label>
                                                    <div class="col-sm-5">
                                                        <input class="form-control" required = "required" type="file" accept=".xls, .xlsx" name="samplesExcel" id="samplesExcel">
                                                    </div>
                                                </div>  <!-- end from-group   -->
                                                <BR>
                                            </div> <!-- End   Panel Body   -->
                                        </div>  <!-- End   Panel    -->
                                        <input class="btn pull-left btn-primary" type="reset" value="Reset Fields">
                                        <input class="btn pull-right btn-primary" type="submit" value="Submit">
                                    </div> <!-- end col-sm-8 -->
                                </form>
                                <br>
                                <p> Fields marked with <FONT COLOR="Red">*</FONT> are mandatory</p>
                            </div> <!--  end of panel body -->
                        </div> <!--  end of panel  -->
                    </div> <!--// end col-sm-10  -->
                </div> <!--  end of row -->
            </div><!-- // end of tab batchSample -->
        </div> <!--  end of Tab  -->
    </div> <!--// end col-sm-12  -->
</div> <!--// end row -->

<script>
    // Get the element with id="defaultOpen" and click on it
    document.getElementById("defaultOpen").click();
</script>
=======
<div id="newSamples" class="tabcontent">
    <div class="mt-5 mb-5 card-fluid" >
            <div style="text-align:center"> 
                <form method="post" enctype="multipart/form-data" name="sampledefinition"  id="sampledefinition" class="form-horizontal well" style="min-height: 500px;">
                    {% csrf_token %} 
                    <input type="hidden" name="action" value="sampledefinition"/>
                    <div id="spreadsheet" class="overflow-scroll" style="width:75%"></div>
                    <br/><br/>
                    <button id='download'>Export my spreadsheet as CSV</button>
                    <input class="btn pull-right btn-primary" type="submit" value="Submit">
                </form>
=======
<style>
    .scrolling-wrapper {
        overflow-x: auto;
        overflow-y: auto;
        white-space: nowrap;
        height: 400px;
    }
 </style>
{% if success %}

{% else %}
     <section>
         <div class="container overflow-hidden">
            <div class="row gx-5">
                <div style="text-align:center">
                    <form method="post" enctype="multipart/form-data" name="sampledata"  id="sampledata" class="form-horizontal well" style="min-height: 500px;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="sampledefinition"/>
                        <div class="scrolling-wrapper">
                            <div id="spreadsheet" class="overflow-scroll" style="width:75%"></div>
                        </div> <!--  end of scrolling  -->
                        <input type="button" value="Download Spreadsheet" onclick="table1.download()"/>
                        <input class="btn pull-right btn-primary" type="submit" value="Submit">
                    </form>
                </div>
>>>>>>> af9a285dadb090336567c38ed527f99623fcf11e
            </div>
        </div>
    </section>

    <script>
        var data = [[]];//initialized with 6 empty rows

        var table1 = jspreadsheet(document.getElementById('spreadsheet'), {
            data:data,
            csvHeaders:true,
            tableOverflow:false,
            columns: [
                {% for item in sample_recorded.heading %}
                    {% if "Date" in item %}
                        { type: 'calendar', title: "{{item}}", width:280 },
                    {% else %}
                        { type: 'text', title: "{{item}}", width:280 },
                    {% endif %}
                {% endfor %}
            ],
            allowInsertColumn:false,
            allowDeleteColumn:false,
            allowRenameColumn:false,
            csvFileName:'Metadata_download',
            minDimensions:[{{sample_recorded.heading|length}},6],
        });
    </script>
    <script>
        $( document ).ready(function () {
            $("#sampledata").submit(function(e){
            //stop submitting the form to see the disabled button effect
            // e.preventDefault();
            //disable the submit button
                var table_data = table1.getData();
                var data_json = JSON.stringify(table_data);
                $("<input />").attr("type", "hidden")
                    .attr("name", "table_data")
                    .attr("value", data_json)
                    .appendTo("#sampledata");
                $("#btnSubmit").attr("disabled", true);
                return true;
                });
        });

<<<<<<< HEAD
                document.getElementById('download').onclick = function () {
                table1.download();
                    
                }

            </script>
>>>>>>> ed41e6b142332ffa6a5607d1e8ec0a86bf84dae5

=======
    </script>
{% endif %}
>>>>>>> af9a285dadb090336567c38ed527f99623fcf11e
{% endblock %}
